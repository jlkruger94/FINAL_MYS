import {writeFileSync}  from "fs";


const scaleCoefficients = (coeffs: number[], scaleBits: number = 11): number[] => {
    const scaleFactor = 1 << scaleBits; // 2^scaleBits
    return coeffs.map(c => Math.round(c * scaleFactor));
  };
  
  // Ejemplo de uso
  const originalCoeffs = [
    0.008575120233577212,
    -0.0057539399461925675,
    0.032555275368685466,
    -0.022676109789151952,
    0.043771821278264136,
    -0.011317667943791881,
    0.024554238356010123,
    0.019713835691788632,
    -0.002405219109814281,
    0.02828134898412119,
    0.002535589932014899,
    -0.001112379729422074,
    0.016625701838293386,
    -0.01846629604994961,
    -0.0060127836479821496,
    -0.004020127614108961,
    -0.03789365615586106,
    -0.008438003957610761,
    -0.024568899805532615,
    -0.04207194524680047,
    0.0006960086082227782,
    -0.033802037572339017,
    -0.01869811522135886,
    0.024142027942022554,
    -0.02552495205393257,
    0.035239701794486315,
    0.0520602767762279,
    -0.00377813339174485,
    0.11421377097915299,
    0.055759618377878274,
    0.0187622409223029,
    0.24751473763311888,
    -0.14201286004970703,
    0.36160237522764377,
    -0.14201286004970703,
    0.24751473763311888,
    0.0187622409223029,
    0.055759618377878274,
    0.11421377097915299,
    -0.00377813339174485,
    0.0520602767762279,
    0.035239701794486315,
    -0.02552495205393257,
    0.024142027942022554,
    -0.01869811522135886,
    -0.033802037572339017,
    0.0006960086082227782,
    -0.04207194524680047,
    -0.024568899805532615,
    -0.008438003957610761,
    -0.03789365615586106,
    -0.004020127614108961,
    -0.0060127836479821496,
    -0.01846629604994961,
    0.016625701838293386,
    -0.001112379729422074,
    0.002535589932014899,
    0.02828134898412119,
    -0.002405219109814281,
    0.019713835691788632,
    0.024554238356010123,
    -0.011317667943791881,
    0.043771821278264136,
    -0.022676109789151952,
    0.032555275368685466,
    -0.0057539399461925675,
    0.008575120233577212
  ];
  
  const scaled = scaleCoefficients(originalCoeffs);
  
// 🖨️ Imprimir para VHDL
let buffer : string = 'constant rom : integer_array := (';
console.log("const h : coef_array_t := (");
scaled.forEach((v, i) => {
  const comma = i < scaled.length - 1 ? ',' : '';
  //console.log(`    to_signed(${v}, DATA_W)${comma}`);
  console.log(`    ${v}${comma}`);
  //buffer += `to_signed(${v}, DATA_W)${comma}\n`;
  buffer += `${v}${comma}\n`;
});
console.log(");");
console.log('Tamaño del array: '+scaled.length);

buffer+= ');';
writeFileSync('./coef.vhd',buffer);